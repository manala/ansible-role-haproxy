---

- name: "{{ test }}"
  hosts: debian
  become: true
  tasks:

    - block:
        - import_tasks: pre_tasks/backports.yml

    - block:
        - file:
            path: tmp/errorfiles/default
            state: absent
        - import_role:
            name: manala.haproxy
          vars:
            manala_haproxy_errorfiles_dir: tmp/errorfiles/default
            manala_haproxy_errorfiles:
              - file: 400.http
                template: errorfiles/400.http.j2
      always:
        - name: Goss
          command: >
            goss --gossfile {{ test }}.goss.yml validate
